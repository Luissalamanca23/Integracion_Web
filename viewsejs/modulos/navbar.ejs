<div class="marquee">
    <div id="barraQueSeMueve" class="barraQueSeMueve">
      <% if (typeof CMF !== 'undefined') { %>
        <% const esDefault = CMF.Dolar === 950 && CMF.UF === 37500 && CMF.EUR === 1050; %>
        <span style="margin-right: 40px;">üí≤ D√≥lar: <%= CMF.Dolar.toLocaleString('es-CL', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %> CLP</span>
        <span style="margin-right: 40px;">üí∏ UF: <%= CMF.UF.toLocaleString('es-CL', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %> CLP</span>
        <span style="margin-right: 40px;">‚Ç¨ Euro: <%= CMF.EUR.toLocaleString('es-CL', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %> CLP</span>
        <% if (esDefault) { %>
          <span style="color: yellow; background: #b00; padding: 2px 10px; border-radius: 5px; margin-left: 30px; font-weight: bold;">ADVERTENCIA: Mostrando valores por defecto, la API CMF no respondi√≥.</span>
        <% } %>
      <% } else { %>
        <span>No hay datos econ√≥micos disponibles.</span>
      <% } %>
    </div>
  </div> 
  <header class="header-area header-sticky">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav class="main-nav">
                    <a href="/" class="logo">
                        <h1>Ferremax</h1>
                    </a>
                    <ul class="nav">
                      <li><a href="/" class="active">Home</a></li>
                      <li><a href="/productos">Productos</a></li>
                      <li><a href="/tiendas">Sucursales</a></li>
                      <li><a href="#" onclick="seguirOrden()">Seguimiento</a></li>
                      <!-- Enlace a Mis Compras (solo visible para usuarios autenticados) -->
                      <li id="mis-compras-link" style="display: none;">
                        <a href="/mis-compras">Mis Compras</a>
                      </li>
                      <!--                       <li><a href="#" id="weather">Clima: <span id="weather-info"></span></a></li>
 -->                      <li><a href="#" onclick="openCartModal()"><i class="fa-solid fa-cart-shopping"></i></a></li>
                      
                      <!-- Indicadores de autenticaci√≥n -->
                      <li id="auth-indicator">
                        <span id="user-info" style="display: none; color: #fff; margin-right: 10px;">
                          Bienvenido, <span id="username"></span>
                        </span>
                        <a href="/login" id="login-btn">Iniciar Sesi√≥n</a>
                        <a href="/logout" id="logout-btn" style="display: none;">Cerrar Sesi√≥n</a>
                      </li>
                  </ul>   
                    <a class='menu-trigger'>
                        <span>Menu</span>
                    </a>
                </nav>
            </div>
        </div>
    </div>
  </header>

  <script>
    // Funci√≥n para verificar el estado de autenticaci√≥n
    async function checkAuthStatus() {
      try {
        const response = await fetch('/api/check-auth');
        const data = await response.json();
        
        const userInfo = document.getElementById('user-info');
        const username = document.getElementById('username');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const misComprasLink = document.getElementById('mis-compras-link');
        
        if (data.isAuthenticated) {
          userInfo.style.display = 'inline';
          username.textContent = data.user.username;
          loginBtn.style.display = 'none';
          logoutBtn.style.display = 'inline';
          
          // Mostrar "Mis Compras" solo para usuarios clientes
          if (data.user.rol === 'cliente') {
            misComprasLink.style.display = 'block';
          }
        } else {
          userInfo.style.display = 'none';
          loginBtn.style.display = 'inline';
          logoutBtn.style.display = 'none';
          misComprasLink.style.display = 'none';
        }
      } catch (error) {
        console.error('Error verificando autenticaci√≥n:', error);
      }
    }
    
    // Verificar estado de autenticaci√≥n al cargar la p√°gina
    document.addEventListener('DOMContentLoaded', checkAuthStatus);
  </script>